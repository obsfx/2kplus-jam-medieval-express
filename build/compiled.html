<body bgcolor="black"><canvas style="border:1px solid #3a3a3a;position: absolute;top: 50%;left: 50%;transform: translate(-50%, -50%);" width="500px" height="500px"></canvas></body><script>let b=document.getElementsByTagName("canvas")[0].getContext("2d"),e=Array(144).fill(99),g=["#0FF","#F61677","#FFF","#0F0"],h="00011001000110010011110101000101010101100111010101100100111011100000000000110000101101111011011100000000111111110000000001000010111111111000000110111101101001011011110110111001101111011011110111111111100000011000000110000001100000011000000110000001100000010000000000000000011000101011110100010100000110000000000000000000000000000000000000011010000110100000001000010111001010100110100000100100001111010001100100000010001110010111010101100110111001010001100000100010001110110001101100101010011011000110101011101010000000000010000000110000011100000111000001110000011111001111111100000000000000000001000000111000011011000111011011111011111111110000000000000000001111000001100000011000000110000011110001111110".split(""),k=[],m=[{c:1,b:2},{c:1,b:3},{c:2,b:4},{c:3,b:4}],p=[{r:4,a:3},{r:4,a:3},{r:4,a:3},{r:5,a:2},{r:5,a:2},{r:5,a:3},{r:6,a:3},{r:6,a:4},{r:6,a:5},{r:6,a:2},{r:7,a:2},{r:5,a:2},{r:5,a:6},{r:6,a:6},{r:6,a:4},{r:7,a:5},{r:7,a:5}],q=0,r=!1,t=!1,u={x:0,y:0},x={x:0,y:0,c:1,d:0,b:15,f:0,a:(a,c,d)=>{99==e[12*c+a]?(v(a,c,x,0),x.f&&(1==d&&x.x-2==u.x&&x.y==u.y&&v(x.x-1,x.y,u,1),0==d&&x.x+2==u.x&&x.y==u.y&&v(x.x+1,x.y,u,1),2==d&&x.x==u.x&&x.y+2==u.y&&v(x.x,x.y+1,u,1),3==d&&x.x==u.x&&x.y-2==u.y&&v(x.x,x.y-1,u,1)),y()):k.filter(f=>f.x==a&&f.y==c&&!f.d)[0]?(d=k.filter(f=>f.x==a&&f.y==c&&!f.d)[0].g,k[d].b-=x.c,0<k[d].b?(console.log("a"),console.log(k[d].b)):(console.log("ded"),k[d].d=1,e[12*c+a]=99),y()):1==e[12*c+a]&&(1!=d||99!=e[12*c+a+1]&&2!=e[12*c+a+1]||(2==e[12*c+a+1]&&(console.log("next room"),++q>p.length-1?(t=!0,b.fillStyle="#000",b.fillRect(0,0,500,500),b.fillStyle="#FF0",b.fillText("Game Over",50,50)):(r=!0,setTimeout(()=>z(),250))),v(a+1,c,u,1),v(a,c,x,0)),0==d&&99==e[12*c+a-1]&&(v(a-1,c,u,1),v(a,c,x,0)),2==d&&99==e[12*(c-1)+a]&&(v(a,c-1,u,1),v(a,c,x,0)),3==d&&99==e[12*(c+1)+a]&&(v(a,c+1,u,1),v(a,c,x,0)))}},A=(a,c)=>Math.floor(Math.random()*(c-a))+a,B=(a,c,d,f,l)=>{for(let n=c;n<c+f;n++)for(let w=a;w<a+d;w++)e[12*n+w]=l},C=()=>{let a=[];e.map((c,d)=>{99==c&&a.push({x:d%12,y:Math.floor(d/12)})});return a},v=(a,c,d,f)=>{e[12*d.y+d.x]=99;d.x=a;d.y=c;e[12*d.y+d.x]=f},y=()=>{k.map((a,c)=>{let d=x.x>a.x?1:-1,f=x.y>a.y?1:-1;2<A(0,9)&&!a.d&&(0==e[12*a.y+a.x+d]||0==e[12*(a.y+f)+a.x]?console.log("mob attack"):99==e[12*a.y+a.x+d]&&x.x!=a.x?(e[12*a.y+a.x+d]=a.t,e[12*a.y+a.x]=99,k[c].x=a.x+d):99==e[12*(a.y+f)+a.x]&&(e[12*(a.y+f)+a.x]=a.t,e[12*a.y+a.x]=99,k[c].y=a.y+f))})},z=()=>{var a=q;console.log(e);B(0,0,12,12,98);B(1,1,10,10,99);var c=C().filter(n=>2<n.x&&7>n.x&&1<n.y&&8>n.y);k=[];var d=A(3,6);for(var f=0;f<d;f++){var l=c.splice(A(0,c.length),1)[0];e[12*l.y+l.x]=A(8,10)}d=A(p[q].a,6);for(f=0;f<d;f++){l=c.splice(A(0,c.length),1)[0];let n=p[q].r;e[12*l.y+l.x]=n;k[k.length]={g:k.length,t:n,b:m[n-4].b,c:m[n-4].d,d:0,x:l.x,y:l.y}}a=a?x.y:A(1,10);c=A(1,10);e[12*a]=2;e[12*c+12-1]=2;e[12*a+1]=0;x.x=1;x.y=a;e[12*a+2]=1;u.x=2;u.y=a;r=!1};window.onkeydown=a=>{a.repeat||r||(69==a.keyCode&&(x.f=1,t&&D()),39==a.keyCode?x.a(x.x+1,x.y,1):37==a.keyCode?x.a(x.x-1,x.y,0):38==a.keyCode?x.a(x.x,x.y-1,2):40==a.keyCode&&x.a(x.x,x.y+1,3))};window.onkeyup=a=>{a.repeat||69!=a.keyCode||(x.f=0)};b.textBaseline="top";b.font="bold 12px monospace";let D=()=>{q=0;t=r=!1;x.c=1;x.d=0;x.b=15;x.f=0;z()};D();setInterval(()=>{t||(b.fillStyle="#000",b.fillRect(0,0,500,500),b.fillStyle=g[2],b.fillRect(12,12,264,264),b.fillStyle="#000",b.fillRect(14,14,260,260),e.map((a,c)=>{if(99!=a){var d=g[2];0==a&&(d=g[0]);1==a&&(d=g[3]);3<a&&8>a&&(d=g[1]);if(98!=a){var f=c%12;c=Math.floor(c/12);for(let l=0;64>l;l++)"0"!=h[64*a+l]?b.fillStyle=d:b.fillStyle="#000",b.fillRect(l%8*3+24*f,3*Math.floor(l/8)+24*c,3,3)}}else b.fillStyle="#666",b.fillRect(c%12*24+8,24*Math.floor(c/12)+8,3,3)}));k.map(a=>{a.d||(b.fillStyle="#000",b.fillRect(24*a.x,24*a.y-12,10,10),b.fillStyle="#FF0",b.fillText(a.b,24*a.x,24*a.y-12))})},1E3/30);</script>