'use strict';let b=document.getElementsByTagName("canvas")[0].getContext("2d"),e=Array(144).fill(99),f=["#0FF","#F61677","#FFF","#0F0"],h="00011001000110010011110101000101010101100111010101100100111011100000000000110000101101111011011100000000111111110000000001000010111111111000000110111101101001011011110110111001101111011011110111111111100000011000000110000001100000011000000110000001100000010000000000000000011000101011110100010100000110000000000000000000000000000000000000011010000110100000001000010111001010100110100000100100001111010001100100000010001110010111010101100110111001010001100000100010001110110001101100101010011011000110101011101010000000000010000000110000011100000111000001110000011111001111111100000000000000000001000000111000011011000111011011111011111111110000000000000000001111000001100000011000000110000011110001111110".split(""),
l=[],m=[{c:1,b:2},{c:1,b:3},{c:1,b:4},{c:2,b:4}],p=[{r:4,a:3},{r:4,a:3},{r:4,a:3},{r:5,a:2},{r:5,a:2},{r:5,a:3},{r:6,a:3},{r:6,a:4},{r:6,a:5},{r:6,a:3},{r:7,a:3},{r:5,a:3},{r:5,a:4},{r:6,a:5},{r:7,a:5}],q,r,t=!0,u=!0,v={x:0,y:0},y={x:0,y:0,c:1,d:0,b:45,f:0,a:(a,c,d)=>{99==e[12*c+a]?(w(a,c,y,0),y.f&&(1==d&&y.x-2==v.x&&y.y==v.y&&w(y.x-1,y.y,v,1),0==d&&y.x+2==v.x&&y.y==v.y&&w(y.x+1,y.y,v,1),2==d&&y.x==v.x&&y.y+2==v.y&&w(y.x,y.y+1,v,1),3==d&&y.x==v.x&&y.y-2==v.y&&w(y.x,y.y-1,v,1)),z()):l.filter(g=>g.x==
a&&g.y==c&&!g.d)[0]?(d=l.filter(g=>g.x==a&&g.y==c&&!g.d)[0].g,l[d].b-=y.c,1>l[d].b&&(l[d].d=1,e[12*c+a]=99),z()):1==e[12*c+a]&&(1!=d||99!=e[12*c+a+1]&&2!=e[12*c+a+1]||(2==e[12*c+a+1]&&(++q>p.length-1?t=!0:(r=!0,setTimeout(()=>A(),250))),w(a+1,c,v,1),w(a,c,y,0),z()),0==d&&99==e[12*c+a-1]&&(w(a-1,c,v,1),w(a,c,y,0),z()),2==d&&99==e[12*(c-1)+a]&&(w(a,c-1,v,1),w(a,c,y,0),z()),3==d&&99==e[12*(c+1)+a]&&(w(a,c+1,v,1),w(a,c,y,0),z()))}},B=(a,c)=>Math.floor(Math.random()*(c-a))+a,C=(a,c,d,g,k)=>{for(let n=
c;n<c+g;n++)for(let x=a;x<a+d;x++)e[12*n+x]=k},D=()=>{let a=[];e.map((c,d)=>{99==c&&a.push({x:d%12,y:Math.floor(d/12)})});return a},w=(a,c,d,g)=>{e[12*d.y+d.x]=99;d.x=a;d.y=c;e[12*d.y+d.x]=g},z=()=>{l.map((a,c)=>{let d=y.x>a.x?1:-1,g=y.y>a.y?1:-1;4<B(0,9)&&!a.d&&(0==e[12*a.y+a.x+d]||0==e[12*(a.y+g)+a.x]?(--y.b,0==y.b&&(y.d=1,t=!0)):99==e[12*a.y+a.x+d]&&y.x!=a.x?(e[12*a.y+a.x+d]=a.t,e[12*a.y+a.x]=99,l[c].x=a.x+d):99==e[12*(a.y+g)+a.x]&&(e[12*(a.y+g)+a.x]=a.t,e[12*a.y+a.x]=99,l[c].y=a.y+g))})},A=()=>
{var a=q;C(0,0,12,12,98);C(1,1,10,10,99);var c=D().filter(n=>2<n.x&&7>n.x&&1<n.y&&8>n.y);l=[];var d=B(3,6);for(var g=0;g<d;g++){var k=c.splice(B(0,c.length),1)[0];e[12*k.y+k.x]=B(8,10)}d=B(p[q].a,6);for(g=0;g<d;g++){k=c.splice(B(0,c.length),1)[0];let n=p[q].r;e[12*k.y+k.x]=n;l[l.length]={g:l.length,t:n,b:m[n-4].b,c:m[n-4].d,d:0,x:k.x,y:k.y}}a=a?y.y:B(1,10);c=B(1,10);e[12*a]=2;e[12*c+12-1]=2;e[12*a+1]=0;y.x=1;y.y=a;e[12*a+2]=1;v.x=2;v.y=a;r=!1};
window.onkeydown=a=>{a.repeat||r||(69==a.keyCode&&(y.f=1,t&&(q=0,u=t=r=!1,y.c=1,y.d=0,y.b=45,y.f=0,A())),39==a.keyCode?y.a(y.x+1,y.y,1):37==a.keyCode?y.a(y.x-1,y.y,0):38==a.keyCode?y.a(y.x,y.y-1,2):40==a.keyCode&&y.a(y.x,y.y+1,3))};window.onkeyup=a=>{a.repeat||69!=a.keyCode||(y.f=0)};b.textBaseline="top";b.font="bold 12px monospace";
setInterval(()=>{b.fillStyle="#000";b.fillRect(0,0,500,500);t?(b.fillStyle="#FF0",y.d&&b.fillText("You died for the gods... for... transportation gods...",24,24),b.fillText("MedEx / created for 2kplus game jam",24,48),b.fillText("github.com/obsfx / twitter.com/obsfx",24,72),u?b.fillText("<Press [E] to start the game>",24,96):b.fillText("Thanks for playing! <Press [E] if you want to play again>",24,96)):(b.fillStyle=f[2],b.fillRect(12,12,264,264),b.fillStyle="#000",b.fillRect(14,14,260,260),e.map((a,
c)=>{if(99!=a){var d=f[2];0==a&&(d=f[0]);1==a&&(y.f&&1==Math.pow(y.x-v.x,2)+Math.pow(y.y-v.y,2)?d=f[2]:d=f[3]);4<=a&&7>=a&&(d=f[1]);if(98!=a){var g=c%12;c=Math.floor(c/12);for(let k=0;64>k;k++)"0"!=h[64*a+k]?b.fillStyle=d:b.fillStyle="#000",b.fillRect(k%8*3+24*g,3*Math.floor(k/8)+24*c,3,3)}}else b.fillStyle="#666",b.fillRect(c%12*24+8,24*Math.floor(c/12)+8,3,3)}),l.map(a=>{a.d||(b.fillStyle="#FF0",b.fillRect(24*a.x,24*a.y-12,8*a.b,5))}),b.fillStyle="#FF0",b.fillText("MedEx: Medival Express",24,288),
b.fillText("Room: "+(q+1)+"/"+p.length+" HP: "+y.b,24,312))},1E3/30);
