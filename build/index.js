'use strict';let b=document.getElementsByTagName("canvas")[0].getContext("2d"),e=[],g=["#0FF","#F61677","#FFF","#0F0"],h="0001100100011001001111010100010101010110011101010110010011101110000000000011000010110111101101110000000011111111000000000100001011111111100000011011110110100101101111011011100110111101101111010000000000000000011000101011110100010100000110000000000000000000000000000000000000011010000110100000001000010111001010100110100000100100001111010001100100000010001110010111010101100110111001010001100000100010001110110001101100101010011011000110101011101010000000000010000000110000011100000111000001110000011111001111111100000000000000000001000000111000011011000111011011111011111111110000000000000000001111000001100000011000000110000011110001111110".split(""),
l=[],m=[{b:1,a:2},{b:1,a:3},{b:1,a:4},{b:2,a:4}],p="333442353452462344453553454553663364336555665".split("").map(a=>Number(a)),q,r,t=!0,u=[],v=!0,w={x:0,y:0},y={x:0,y:0,b:1,d:0,a:30,c:0,f:(a,c,d)=>{99==e[12*c+a]?(x(a,c,y,0),y.c&&(1==d&&y.x-2==w.x&&y.y==w.y&&x(y.x-1,y.y,w,1),0==d&&y.x+2==w.x&&y.y==w.y&&x(y.x+1,y.y,w,1),2==d&&y.x==w.x&&y.y+2==w.y&&x(y.x,y.y+1,w,1),3==d&&y.x==w.x&&y.y-2==w.y&&x(y.x,y.y-1,w,1)),A()):l.filter(f=>f.x==a&&f.y==c&&!f.d)[0]?(d=l.filter(f=>f.x==a&&f.y==c&&!f.d)[0].g,l[d].a-=
y.b,u.push("you attacked"),1>l[d].a&&(l[d].d=1,e[12*c+a]=99,u.push("you killed a creature")),A()):1==e[12*c+a]&&(1!=d||99!=e[12*c+a+1]&&2!=e[12*c+a+1]||(2==e[12*c+a+1]&&(14<++q?t=!0:(r=!0,u.push("next room"),setTimeout(()=>B(),200))),x(a+1,c,w,1),x(a,c,y,0),A()),0==d&&99==e[12*c+a-1]&&(x(a-1,c,w,1),x(a,c,y,0),A()),2==d&&99==e[12*(c-1)+a]&&(x(a,c-1,w,1),x(a,c,y,0),A()),3==d&&99==e[12*(c+1)+a]&&(x(a,c+1,w,1),x(a,c,y,0),A()))}},C=(a,c)=>Math.floor(Math.random()*(c-a))+a,D=(a,c,d,f,k)=>{for(let n=c;n<
c+f;n++)for(let z=a;z<a+d;z++)e[12*n+z]=k},E=()=>{let a=[];e.map((c,d)=>{99==c&&a.push({x:d%12,y:Math.floor(d/12)})});return a},x=(a,c,d,f)=>{e[12*d.y+d.x]=99;d.x=a;d.y=c;e[12*d.y+d.x]=f;u.push(0==f?"you moved":"package moved")},A=()=>{l.map((a,c)=>{let d=y.x>a.x?1:-1,f=y.y>a.y?1:-1;4<C(0,9)&&!a.d&&(0==e[12*a.y+a.x+d]||0==e[12*(a.y+f)+a.x]?(--y.a,u.push("you took damage"),0==y.a&&(y.d=1,t=!0)):99==e[12*a.y+a.x+d]&&y.x!=a.x?(e[12*a.y+a.x+d]=a.t,e[12*a.y+a.x]=99,l[c].x=a.x+d):99==e[12*(a.y+f)+a.x]&&
(e[12*(a.y+f)+a.x]=a.t,e[12*a.y+a.x]=99,l[c].y=a.y+f))})},B=()=>{var a=q;D(0,0,12,12,98);D(1,1,10,10,99);var c=E().filter(n=>2<n.x&&7>n.x&&1<n.y&&8>n.y);l=[];var d=C(3,6);for(var f=0;f<d;f++){var k=c.splice(C(0,c.length),1)[0];e[12*k.y+k.x]=C(7,10)}d=C(p[3*q+2],p[3*q+2]+2);for(f=0;f<d;f++){k=c.splice(C(0,c.length),1)[0];let n=C(p[3*q],p[3*q+1]+1);e[12*k.y+k.x]=n;l[l.length]={g:l.length,t:n,a:m[n-3].a,b:m[n-3].d,d:0,x:k.x,y:k.y}}a=a?y.y:C(1,10);c=C(1,10);e[12*a]=2;e[12*c+12-1]=2;e[12*a+1]=0;y.x=1;
y.y=a;e[12*a+2]=1;w.x=2;w.y=a;r=!1};window.onkeydown=a=>{a.repeat||r||(69==a.keyCode&&(y.c=1,t&&(q=0,v=t=r=!1,u=[],y.b=1,y.d=0,y.a=30,y.c=0,B())),39==a.keyCode?y.f(y.x+1,y.y,1):37==a.keyCode?y.f(y.x-1,y.y,0):38==a.keyCode?y.f(y.x,y.y-1,2):40==a.keyCode&&y.f(y.x,y.y+1,3))};window.onkeyup=a=>{a.repeat||69!=a.keyCode||(y.c=0)};b.textBaseline="top";b.font="bold 12px monospace";
setInterval(()=>{b.fillStyle="#000";b.fillRect(0,0,500,500);if(t){let a=[];a.push("Medieval Express / 2kplus / twitter github @obsfx");y.d?a.push("You died for the gods.. for.. transportation gods."):v||a.push("You delivered the package!");v||a.push("Thanks for playing!");a.push("Press E to start the game");b.fillStyle="#FF0";a.map((c,d)=>b.fillText(c,24,24*(d+1)))}else b.fillStyle=g[2],b.fillRect(12,12,264,264),b.fillStyle="#000",b.fillRect(14,14,260,260),e.map((a,c)=>{if(99!=a){var d=g[2];0==a&&
(d=g[0]);1==a&&(y.c&&1==Math.pow(y.x-w.x,2)+Math.pow(y.y-w.y,2)?d=g[2]:d=g[3]);3<=a&&6>=a&&(d=g[1]);if(98!=a){var f=c%12;c=Math.floor(c/12);for(let k=0;64>k;k++)"0"!=h[64*a+k]?b.fillStyle=d:b.fillStyle="#000",b.fillRect(k%8*3+24*f,3*Math.floor(k/8)+24*c,3,3)}}else b.fillStyle="#666",b.fillRect(c%12*24+8,24*Math.floor(c/12)+8,3,3)}),l.map(a=>{a.d||(b.fillStyle="#FF0",b.fillRect(24*a.x,24*a.y-12,8*a.a,5))}),b.fillStyle="#FF0",b.fillText("Room: "+(q+1)+"/15 HP: "+y.a,24,312),u.map((a,c,d)=>b.fillText(d[d.length-
1-c],312,24*(c+1))),20<u.length&&u.shift()},1E3/30);
